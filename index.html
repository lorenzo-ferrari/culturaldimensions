<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="dist/output.css" rel="stylesheet">
    <script type="application/javascript" src="./questions.js"></script>
    <title>Cultural Dimensions</title>
  </head>
  <body class="area" style="overflow-x:hidden;">
  <div class="">
  <ul class="circles relative -z-10">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
  </ul>

    <nav class="flex justify-center items-center z-10">
      <div class="rounded-b-xl bg-white h-[4rem] px-[5rem] w-[80%] min-w-[500px] items-center flex justify-around max-w-[900px] md:w-[65%] p-5 shadow-md">
        <div class="inline-block w-[30%] min-w-[200px] mx-auto"></p><p class="inline-block font-bold text-blue-500 text-3xl ">Cultural Dimensions</p></div>
        <div class="w-[70%] mx-[10%] justify-around flex">
          <span class="text-blue-400 font-bold px-4 py-3 cursor-pointer rounded-md hover:bg-blue-600 text-xl transition-[1s]">Home</span>
          <span class="text-blue-400 font-bold px-4 py-3 cursor-pointer rounded-md hover:bg-blue-600 text-xl cursortransition-[1s]">Test</span>
          <span class="text-blue-400 font-bold px-4 py-3 cursor-pointer rounded-md hover:bg-blue-600 text-xl transition-[1s]">About</span>
        </div>
      </div>
    </nav>

    <div class="container flex justify-center items-center my-10  h-[80vh] w-[100%] bg-gradient-to-tr from-white to-white rounded-xl mx-auto shadow-md flex-col min-h-[580px] max-w-[700px] sm:w-[60%] p-5">

      <h1 class="font-bold text-black text-3xl transition-[2s] relative top-0 mx-5 text-center" id="introText">Which country are you culturally closest to?</h1>
      <button onclick="beginQuestionnaire()" id="button" class="bg-cyan-800 hover:bg-blue-600 transition-[1s] text-white px-8 py-5 m-5 rounded-xl text-xl cursor-pointer">Start the test</button>

      <div class="flex flex-col justify-center relative top-[-200px] w-full h-[10vh]">

        <h2 id="questionText" class="invisible text-2xl text-black text-center top-[7rem] relative opacity-0 transition-[1s] mx-auto"></h2>
        
        <div id="questionBox" class="mx-auto relative top-[10rem] justify-center items-center text-center invisible opacity-0 transition-[1s]">
          <div onclick="nextQuestion(1)" id="option1" class="w-[80%] unselectable hover:bg-green-700 whitespace-nowrap cursor-pointer px-[10rem] h-[3rem] bg-green-600 mx-auto justify-center flex items-center rounded my-1">placeholder</div>
          <div onclick="nextQuestion(2)" id="option2" class="w-[80%] unselectable hover:bg-green-400 whitespace-nowrap cursor-pointer px-[10rem] h-[3rem] bg-green-300 mx-auto justify-center flex items-center rounded my-1">placeholder</div>
          <div onclick="nextQuestion(3)" id="option3" class="w-[80%] unselectable hover:bg-gray-600 whitespace-nowrap cursor-pointer px-[10rem] h-[3rem] bg-gray-500 mx-auto justify-center flex items-center rounded my-1">placeholder</div>
          <div onclick="nextQuestion(4)" id="option4" class="w-[80%] unselectable hover:bg-red-400 whitespace-nowrap cursor-pointer px-[10rem] h-[3rem] bg-red-300 mx-auto justify-center flex items-center rounded my-1">placeholder</div>
          <div onclick="nextQuestion(5)" id="option5" class="w-[80%] unselectable hover:bg-red-700 whitespace-nowrap cursor-pointer px-[10rem] h-[3rem] bg-red-600 mx-auto justify-center flex items-center rounded my-1">placeholder</div>
        </div>
        
      </div>
    </div>
  </div>
  </body>
  <style>
    .circles {
      height:120%;
    }

    #but:active {
      -webkit-animation-name: cssAnimation;
  -webkit-animation-duration: 3s;
  -webkit-animation-iteration-count: 1;
  -webkit-animation-timing-function: ease;
  -webkit-animation-fill-mode: forwards;
    }

    @-webkit-keyframes cssAnimation {
      from {
        border:0;
      }
      to {
        border: 3px solid black;
      }
    }



    .area {
      background: linear-gradient(to bottom right, rgb(105, 189, 215), rgb(71, 61, 185));
      height:120vh;
      min-height: 730px;
    }
    
    .range {
      display: inline-block;
      --SliderColor: hsl(50, 100%, 50%);
      margin: 36px 20px 20px
    }

    input[type=range] {
      -webkit-appearance: none;
      position: relative
    }

    input[type=range]::-webkit-slider-runnable-track {
      width: 300px;
      height: 4px;
      border: none;
      border-radius: 3px
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      border: none;
      height: 24px;
      width: 24px;
      border-radius: 510%;
      background: var(--SliderColor);
      margin-top: -10px;
      cursor: pointer
    }

    .focused::-webkit-slider-thumb {
      box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.15)
    }

    .clicked::-webkit-slider-thumb {
      -webkit-transform: scale(1.5)
    }

    .disabled::-webkit-slider-thumb {
      -webkit-transform: scale(0.9);
      box-shadow: 0 0 0 3px #141414;
      background: #515151 !important;
      border-color: #515151 !important
    }

    input[type=range]:focus {
      outline: none
    }

    .rangeM input[type=range].disabled::-webkit-slider-runnable-track {
      background: #515151!important
    }

    .rangeM input[type=range]::-webkit-slider-thumb {
      background: #3f51b5;
      border-color: #3f51b5
    }

    .range:hover input[type=range]:before {
      color: white;
      content: '50';
      position: absolute;
      font-family: Roboto Slab;
      top: -49px;
      background: #3f51b5;
      padding: 8px 0 3px;
      font-size: 14px;
      width: 30px;
      text-align: center;
      border-radius: 100% 100% 0 0
    }

    .range:hover input[type=range]:after {
      content: '';
      position: absolute;
      top: -19px;
      left: 50px;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 8px solid #3f51b5;
      font-family: Roboto Slab
    }

    .unselectable {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>

  <!-- JavaScript for the test itself -->
  <script>
    let button = document.getElementById("button");
    let introText = document.getElementById("introText");

    // let questionIntro = document.getElementById("questionIntro");
    let questionText = document.getElementById("questionText");
    let questionBox = document.getElementById("questionBox");
    let slider = document.getElementById("slider");
    let slider_container = document.getElementById("slider-container");

    let current_question = 0;
    let answers = [];

    function beginQuestionnaire() {
      button.style.visibility = "hidden";
      button.style.opacity = "0";

      introText.style.top = "-120px";

      questionText.style.visibility = "visible";
      questionBox.style.visibility = "visible";
      questionBox.style.opacity = "1";

      initQuestion();

      setTimeout(() => {
        questionText.style.opacity = "1";
        // questionIntro.style.opacity = "1";
       }, 300);
    }

    function nextQuestion(value) {
      answers[current_question] = value;
      ++current_question;

      console.log("answer: " + current_question);

      if (current_question == questions.length) {
        results();
        console.log(answers);
      } else {
        initQuestion();
      }
    }

    function initQuestion() {
      introText.innerHTML = questions[current_question].intro;
      questionText.innerHTML = questions[current_question].text;
      for (let i = 0; i < 5; ++i) {
        var option = "option" + (i+1);
        document.getElementById(option).innerHTML = questions[current_question].options[i];
      }
    }

    function percentage(value, min, max) {
      let ans = (value - min) / (max - min) * 100;
      return ans.toFixed(1);
    }
    function m(i) { return answers[i-1]; }
    function results() {
      // http://geerthofstede.com/wp-content/uploads/2016/07/Manual-VSM-2013.pdf
      let extreme_values = {
        "pdi":240,
        "idv":280,
        "mas":280,
        "uai":260,
        "lto":260,
        "ivr":300
      };
      let abs_values = [];
      abs_values[0] = 35*(m(07) - m(02)) + 25*(m(20) - m(23)); // PDI
      abs_values[1] = 35*(m(04) - m(01)) + 35*(m(09) - m(06)); // IDV
      abs_values[2] = 35*(m(05) - m(03)) + 35*(m(08) - m(10)); // MAS
      abs_values[3] = 40*(m(18) - m(15)) + 25*(m(21) - m(24)); // UAI
      abs_values[4] = 40*(m(13) - m(14)) + 25*(m(19) - m(22)); // LTO
      abs_values[5] = 35*(m(12) - m(11)) + 40*(m(17) - m(16)); // IVR

      let rel_values = [];
      rel_values[0] = percentage(abs_values[0], -extreme_values["pdi"], extreme_values["pdi"]); // PDI
      rel_values[1] = percentage(abs_values[1], -extreme_values["idv"], extreme_values["idv"]); // IDV
      rel_values[2] = percentage(abs_values[2], -extreme_values["mas"], extreme_values["mas"]); // MAS
      rel_values[3] = percentage(abs_values[3], -extreme_values["uai"], extreme_values["uai"]); // UAI
      rel_values[4] = percentage(abs_values[4], -extreme_values["lto"], extreme_values["lto"]); // LTO
      rel_values[5] = percentage(abs_values[5], -extreme_values["ivr"], extreme_values["ivr"]); // IVR

      let new_location = `results.html`
              + `?pdi=${rel_values[0]}`
              + `&idv=${rel_values[1]}`
              + `&mas=${rel_values[2]}`
              + `&uai=${rel_values[3]}`
              + `&lto=${rel_values[4]}`
              + `&ivr=${rel_values[5]}`;

      location.href = new_location;
    }

  </script>
</html>
