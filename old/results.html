<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Cultural Dimensions</title>
  <script type="application/javascript" src="countries.js"></script>
</head>

<body>

<h2>Your cultural dimensions:</h2>
<p>Power distance: <span id="pdi">NaN</span></p>
<p>Individualism: <span id="idv">NaN</span></p>
<p>Masculinity: <span id="mas">NaN</span></p>
<p>Uncertainty Anavoidance: <span id="uai">NaN</span></p>
<p>Long term orientation: <span id="lto">NaN</span></p>
<p>Indulgence: <span id="ivr">NaN</span></p>

<h2>Closest countries:</h2>
<p id="closest_1">placeholder</p>
<p id="closest_2">placeholder</p>
<p id="closest_3">placeholder</p>
<p id="closest_4">placeholder</p>
<p id="closest_5">placeholder</p>

<script>

  function getQueryVariable(variable)
  {
    var query = window.location.search.substring(1)
    var vars = query.split("&")
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=")
        if(pair[0] == variable) {return pair[1]}
    }
    return(NaN);
  }

  document.getElementById("pdi").innerHTML = getQueryVariable("pdi");
  document.getElementById("idv").innerHTML = getQueryVariable("idv");
  document.getElementById("mas").innerHTML = getQueryVariable("mas");
  document.getElementById("uai").innerHTML = getQueryVariable("uai");
  document.getElementById("lto").innerHTML = getQueryVariable("lto");
  document.getElementById("ivr").innerHTML = getQueryVariable("ivr");

  values = [];
  values[0] = getQueryVariable("pdi");
  values[1] = getQueryVariable("idv");
  values[2] = getQueryVariable("mas");
  values[3] = getQueryVariable("uai");
  values[4] = getQueryVariable("lto");
  values[5] = getQueryVariable("ivr");

  function distance_sq(oth) {
    ans = 0;
    for (let i = 0; i < 6; ++i) {
      ans += (values[i] - oth[i]) * (values[i] - oth[i]);
    }
    return ans;
  }

  let k = 5; // find the closest k countries
  let closest = [];
  for (let i = 0; i < k; ++i) closest[i] = NaN;

  for (let i = 0; i < countries.length; ++i) {
    console.log(closest);
    if (isNaN(closest[k-1]) || distance_sq(countries[closest[k-1]].values) > distance_sq(countries[i].values)) {
      closest[k-1] = i;
    }
    for (let j = k-2; j >= 0; --j) {
      if (isNaN(closest[j]) || distance_sq(countries[closest[j+1]].values) < distance_sq(countries[closest[j]].values)) {
        let tmp = closest[j];
        closest[j] = closest[j+1];
        closest[j+1] = tmp;
      }
    }
  }

  for (let i = 0; i < k; ++i) {
    let id = "closest_" + (i+1);
    document.getElementById(id).innerHTML = countries[closest[i]].name + " : " + countries[closest[i]].values;
  }

</script>
</body>
</html>
