<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Cultural Dimensions</title>
  <script type="application/javascript" src="questions.js"></script>
</head>

<body>

<h3 id="intro">An error occured while loading the question...</h3>
<h3 id="question">An error occured while loading the question...</h3>
<button id="option1" onclick="next_question(1)" style="background-color: #378039;">1</button> <br>
<button id="option2" onclick="next_question(2)" style="background-color: #52bf56;">2</button> <br>
<button id="option3" onclick="next_question(3)" style="background-color: #bbbbbb;">3</button> <br>
<button id="option4" onclick="next_question(4)" style="background-color: #f44336;">4</button> <br>
<button id="option5" onclick="next_question(5)" style="background-color: #b71c1c;">5</button> <br>

<!-- JavaScript for the test itself -->
<script>
  var qn = 0; // Question number
  let answers = [];

  init_question();

  function init_question() {
    document.getElementById("intro").innerHTML = questions[qn].intro;
    document.getElementById("question").innerHTML = questions[qn].text;
    for (let i = 0; i < 5; ++i) {
      var option = "option" + (i+1);
      document.getElementById(option).innerHTML = questions[qn].options[i];
    }
  }

  function next_question(answer) {
    answers[qn] = answer;
    ++qn;

    if (qn == questions.length) {
      results();
    } else {
      init_question();
    }
  }

  function percentage(value, min, max) {
    let ans = (value - min) / (max - min) * 100;
    return ans.toFixed(1);
  }
  function m(i) { return answers[i-1]; }
  function results() {
    // http://geerthofstede.com/wp-content/uploads/2016/07/Manual-VSM-2013.pdf
    let extreme_values = {
      "pdi":240,
      "idv":280,
      "mas":280,
      "uai":260,
      "lto":260,
      "ivr":300
    };
    let abs_values = [];
    abs_values[0] = 35*(m(07) - m(02)) + 25*(m(20) - m(23)); // PDI
    abs_values[1] = 35*(m(04) - m(01)) + 35*(m(09) - m(06)); // IDV
    abs_values[2] = 35*(m(05) - m(03)) + 35*(m(08) - m(10)); // MAS
    abs_values[3] = 40*(m(18) - m(15)) + 25*(m(21) - m(24)); // UAI
    abs_values[4] = 40*(m(13) - m(14)) + 25*(m(19) - m(22)); // LTO
    abs_values[5] = 35*(m(12) - m(11)) + 40*(m(17) - m(16)); // IVR

    let rel_values = [];
    rel_values[0] = percentage(abs_values[0], -extreme_values["pdi"]*0.8, extreme_values["pdi"]*0.8); // PDI
    rel_values[1] = percentage(abs_values[1], -extreme_values["idv"]*0.8, extreme_values["idv"]*0.8); // IDV
    rel_values[2] = percentage(abs_values[2], -extreme_values["mas"]*0.8, extreme_values["mas"]*0.8); // MAS
    rel_values[3] = percentage(abs_values[3], -extreme_values["uai"]*0.8, extreme_values["uai"]*0.8); // UAI
    rel_values[4] = percentage(abs_values[4], -extreme_values["lto"]*0.8, extreme_values["lto"]*0.8); // LTO
    rel_values[5] = percentage(abs_values[5], -extreme_values["ivr"]*0.8, extreme_values["ivr"]*0.8); // IVR

    let new_location = `results.html`
            + `?pdi=${rel_values[0]}`
            + `&idv=${rel_values[1]}`
            + `&mas=${rel_values[2]}`
            + `&uai=${rel_values[3]}`
            + `&lto=${rel_values[4]}`
            + `&ivr=${rel_values[5]}`;

    location.href = new_location;
  }
</script>

</body>
</html>
